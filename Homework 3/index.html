<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <title>Formulár</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.11.2/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.11.2/js/bootstrap-select.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="./assets/style.css">
</head>
<body>
<section class="pink">
    <div class="relative-wrapper">
        <div id="happy-muffin"></div>
    </div>
</section>
<section class="pinky-pink"></section>
<div class="container">
    <div class="row">
        <div class="col-lg-6 col-lg-offset-3 form-top">
            <form id="myForm" name="myForm" onsubmit="return validateForm(this)" method="post">
                <input name="name" type="hidden" value="Lukas Stranovsky">
                <div class="form-group">
                        <span data-toggle="tooltip" title="Validná emailová adresa" class="custom-tooltip"><i
                                class="fa fa-question-circle" aria-hidden="true"></i> </span><label for="email">Emailová
                    adresa *</label>
                    <input name="email" type="email" onblur="validateEmail(this)" class="form-control" id="email"
                           placeholder="napr. mnamky@mnam.sk">
                    <div class="error_message">
                        <ul id="email_error_container">
                        </ul>
                    </div>
                </div>
                <div class="form-group">
                        <span data-toggle="tooltip" title="Rodné číslo zadávajte s lomkou" class="custom-tooltip"><i
                                class="fa fa-question-circle" aria-hidden="true"></i> </span><label for="birthNum">Rodné
                    číslo *</label>
                    <input id="birthNum" name="birthNum" onblur="validateBirthNum(this)" type="text"
                           class="form-control"
                           placeholder="napr. 758598/7863">
                    <div class="error_message">
                        <ul id="birthNum_error_container">
                        </ul>
                    </div>
                </div>
                <div class="form-group">
                        <span data-toggle="tooltip" title="Dátum narodenia v tvare napr. 29-Apr-1995 "
                              class="custom-tooltip"><i class="fa fa-question-circle"
                                                        aria-hidden="true"></i> </span><label>Dátum narodenia *</label>
                    <input id="birthDate" name="birthDate" onblur="validateBirthDate(this)" type="date"
                           class="form-control"
                           placeholder="Dátum narodenia">
                    <div class="error_message">
                        <ul id="birthDate_error_container">
                        </ul>
                    </div>
                </div>
                <div class="form-group">
                    <label for="age">Vek *</label>
                    <input id="age" name="age" onblur="validateAge(this)" type="number" min="0" class="form-control"
                           placeholder="napr. 38">
                    <div class="error_message">
                        <ul id="age_error_container">
                        </ul>
                    </div>
                </div>
                <div class="radio-group">
                    <div class="radio">
                        <label class="label label-danger"><input id="woman" type="radio" name="optradio">Žena <i
                                class="fa fa-venus" aria-hidden="true"></i></label>
                    </div>
                    <div class="radio">
                        <label class="label label-primary"><input id="man" type="radio" name="optradio">Muž <i
                                class="fa fa-mars" aria-hidden="true"></i></label>
                    </div>
                    <div class="radio disabled">
                        <label class="label label-default"><input type="radio" name="optradio" checked disabled>Niečo
                            medzi <i class="fa fa-question" aria-hidden="true"></i></label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="selectbox">Obľúbená rozprávka</label>
                    <select id="selectbox" class="selectpicker">
                        <option value="none" selected disabled>Vyberte si</option>
                        <option class="for-woman" data-icon="glyphicon-heart">Shrek</option>
                        <option class="for-woman" data-icon="glyphicon-heart">Cesta do fantázie</option>
                        <option class="for-woman" data-icon="glyphicon-heart">Ako vycvičiť draka</option>
                        <option class="for-man" data-icon="glyphicon-heart">Leví kráľ</option>
                        <option class="for-man" data-icon="glyphicon-heart">Hľadá sa Nemo</option>
                        <option class="for-man" data-icon="glyphicon-heart">Lady a Tramp</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="comment">Odkaz pre nás</label>
                    <textarea class="form-control" rows="2" id="comment"></textarea>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" checked>Chcem sa prihlásiť na odber noviniek</label>
                </div>
                <button type="submit" class="btn btn-md btn-success pull-right">Odoslať</button>
            </form>
        </div>
        <img id="shadow" src="./assets/shadow.png" alt="">
    </div>
</div>
<footer>
    <div id="footer-img">
        <div id="github-img">
            <a target="_blank" href="https://github.com/Luxato/web-technologies"><i class="fa fa-github"
                                                                                    aria-hidden="true"></i>
            </a>
        </div>
        <div id="hello-kitty"></div>
    </div>
</footer>
<script src="./assets/javascript.dateformat.js"></script>
<script>
    // Array errorMessages is used for error memorizing.
    var errorMessages = [];
    // Array months is used for days in month validation.
    var months = {
        "1": 31,
        "2": 28,
        "3": 31,
        "4": 30,
        "5": 31,
        "6": 30,
        "7": 31,
        "8": 31,
        "9": 30,
        "10": 31,
        "11": 30,
        "12": 31
    };

    function validateForm(myForm) {
        validateEmail(myForm.email);
        validateBirthNum(myForm.birthNum);
        validateBirthDate(myForm.birthDate);
        validateAge(myForm.age);
    }

    function validateBirthDate(birthDate) {
        if (birthDate.value.length == 0) {
            addErrorClass(birthDate);
            errorMessages.push("Dátum narodenia musí byť zadaný!");
        } else {
            var tmp = birthDate.value.split("-");
            var year = tmp[0];
            if (year > 2016) {
                addErrorClass(birthDate);
                errorMessages.push("Rok narodenia musí byť menší ako 2016.");
            } else if (year < 1900) {
                addErrorClass(birthDate);
                errorMessages.push("Rok narodenia musí byť vyšší než 1900");
            } else {
                removeErrorClass(birthDate);
            }
        }
        // Show errors.
        showErrorsNearInput('birthDate_error_container');
    }

    function validateBirthNum(birthNum) {
        var error = false;
        if (birthNum.value.length == 0) {
            addErrorClass(birthNum);
            errorMessages.push("Rodné číslo musí byť zadané!");
            error = true;
        } else {
            // B Date is set.
            if (birthNum.value.length < 10) {
                addErrorClass(birthNum);
                errorMessages.push("Dĺžka rodného čísla musí byť 10 alebo 11 znakov. Napr. 960610/2000 alebo 360431/200!");
                error = true;
            } else if (birthNum.value[6] != '/') {
                addErrorClass(birthNum);
                errorMessages.push("Siedmy znak v rodnom čísle musí byť lomka. Napr. 960610/2000 alebo 360431/200!");
                error = true;
            } else {
                removeErrorClass(birthNum);
            }
        }
        if (!error) {
            // If there is no error, lets write data to other inputs.
            var tmp = birthNum.value.split("/");
            var tmp2 = tmp[0].match(/.{1,2}/g);
            // Get year.
            if (tmp2[0] < 54 && tmp[1].length == 3) {
                // We have person who was born before 1954.
                var year = '19' + tmp2[0];
            } else if (tmp2[0] < 54 && tmp[1].length == 4) {
                // We have young who was born in or after 2000.
                var year = '20' + tmp2[0];
            } else {
                // We have person who was born after 1954 and is older then 2000.
                var year = '19' + tmp2[0];
            }
            // Get month.
            if (parseInt(tmp2[1]) > 12) {
                // We have some woman here.
                var month = parseInt(tmp2[1]) - 50;
                document.getElementById("woman").checked = true;
                sortCartoons(1); // Sort cartoons for woman.
            } else {
                var month = tmp2[1];
                document.getElementById("man").checked = true;
                sortCartoons(0); // Sort cartoons for men.
            }
            var day = tmp2[2];
            // Check if days in month are valid
            if(month[0] == 0) {
                var month = month.substr(1);
            }
            console.log(day);
            console.log(months[month]);
            if(day > months[month]) {
                // We have more days then allowed.
                addErrorClass(birthNum);
                errorMessages.push("Pre mesiac " + month + " je maximalny pocet dni len " + months[month]);
            }
            // Calculate and add age to input.
            var newDate = month + "/" + day + "/" + year;
            var birthDay = new Date(newDate);
            var age = _calculateAge(birthDay.getTime());
            document.getElementById('age').value = age;
            // Add date to input.
            document.getElementById('birthDate').value = birthDay.format("yyyy-mm-dd");
        }
        // Show errors.
        showErrorsNearInput('birthNum_error_container');
    }

    function sortCartoons(gender) {
        // Gender 0 is man, gender 1 is woman.
        gender = gender ? 'woman' : 'man';
        var select = document.getElementById('selectbox').options;
        var dynamicInputs = document.getElementsByClassName("dropdown-menu inner");
        dynamicInputs = dynamicInputs[0].getElementsByTagName("li");
        select[1].selected = 'selected';
        for (var i = 1, max = select.length; i < max; i++) {
            // Show woman cartoons, hide men cartoons
            if (gender == 'woman') {
                if (select[i].className.indexOf('for-woman') !== -1) {
                    select[i].className = select[i].className.replace('hidden', '');
                    dynamicInputs[i].className = dynamicInputs[i].className.replace('hidden', '');
                }
                if (select[i].className.indexOf('for-man') !== -1) {
                    select[i].className = 'for-man hidden';
                    dynamicInputs[i].className = 'hidden';
                }
            }
            // Show man cartoons, hide woman cartoons.
            if (gender == 'man') {
                if (select[i].className.indexOf('for-man') !== -1) {
                    select[i].className = select[i].className.replace('hidden', '');
                    dynamicInputs[i].className = dynamicInputs[i].className.replace('hidden', '');
                }
                if (select[i].className.indexOf('for-woman') !== -1) {
                    select[i].className = 'for-woman hidden';
                    dynamicInputs[i].className = 'hidden';
                }
            }
        }
    }

    function _calculateAge(birthday) { // birthday is a date
        var ageDifMs = Date.now() - birthday;
        var ageDate = new Date(ageDifMs); // miliseconds from epoch
        return Math.abs(ageDate.getUTCFullYear() - 1970);
    }

    function validateAge(age) {
        if (age.value.length == 0) {
            // When age is not set.
            addErrorClass(age);
            errorMessages.push("Vek musi byť zadany!");
        } else {
            // Age is set
            if (age.value < 0) {
                addErrorClass(age);
                errorMessages.push("Vek nesmie byť záporné číslo!");
            } else if(age.value > 120) {
                addErrorClass(age);
                errorMessages.push("Vek nesmie byť vyšší ako 120 rokov!");
            } else {
                removeErrorClass(age);
            }
        }
        // Show errors.
        showErrorsNearInput('age_error_container');
    }

    function showErrorsNearInput(inputID) {
        var result = "";
        for (var i = 0, max = errorMessages.length; i < max; i++) {
            result += "<li>";
            result += errorMessages[i];
            result += "</li>";
        }
        // Errors are saved, lets null array.
        errorMessages = [];
        // Write them on screen.
        document.getElementById(inputID).innerHTML = result;
    }

    /**
     * Validate email as required field and format.
     */
    function trim(s) {
        return s.replace(/^\s+|\s+$/, '');
    }

    function validateEmail(email) {
        var temail = trim(email.value); // value of field with whitespace trimmed off
        var emailFilter = /^[^@]+@[^@.]+\.[^@]*\w\w$/;
        var illegalChars = /[\(\)\<\>\,\;\:\\\"\[\]]/;

        if (email.value == "") {
            addErrorClass(email);
            errorMessages.push("Email musi byt zadany!");
        } else if (!emailFilter.test(temail)) { //test email for illegal characters
            addErrorClass(email);
            errorMessages.push("Email obsahuje nepovolene znaky!");
        } else if (email.value.match(illegalChars)) {
            addErrorClass(email);
            errorMessages.push("Email je neplatny!");
        } else {
            removeErrorClass(email);
        }
        // Show errors.
        showErrorsNearInput('email_error_container');
    }

    /**
     * Add error class to input which makes it red.
     * @param element
     */
    function addErrorClass(element) {
        var classString = element.className;
        if (classString.indexOf('custom-error') === -1) { // Prevent duplicate classes.
            var newClass = classString.concat(" custom-error");
            element.className = newClass;
        }
    }

    /**
     * Remove error class which makes input white.
     * @param element
     */
    function removeErrorClass(element) {
        var classString = element.className;
        var newClass = classString.replace("custom-error", "");
        element.className = newClass;
    }

    var _woman = document.getElementById('woman');
    var _man = document.getElementById('man');
    _woman.onchange = function () {
        if (_woman.checked) {
            sortCartoons(1);
        } else {
            sortCartoons(0);
        }
    };
    _man.onchange = function () {
        if (_woman.checked) {
            sortCartoons(1);
        } else {
            sortCartoons(0);
        }
    };

    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();
        $('#myForm').submit(function (e) {
            e.preventDefault();
        });
    });
</script>
</body>
</html>